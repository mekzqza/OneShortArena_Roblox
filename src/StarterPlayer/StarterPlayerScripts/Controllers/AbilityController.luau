--!strict
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

-- ‡∏î‡∏∂‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ
local EventBus = require(ReplicatedStorage.SystemsShared.EventBus)
local Events = require(ReplicatedStorage.Shared.Events)
local InputSettings = require(ReplicatedStorage.Shared.InputSettings)

local AbilityController = {}

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏Å‡∏Ç‡∏≠‡∏á (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ù‡∏±‡πà‡∏á Client ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô)
local function SpawnMagicCube()
	local player = Players.LocalPlayer
	local character = player.Character
	if not character or not character:FindFirstChild("HumanoidRootPart") then return end

	local rootPart = character:FindFirstChild("HumanoidRootPart") :: Part
	
	-- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô (Part)
	local magicPart = Instance.new("Part")
	magicPart.Name = "MagicCube"
	magicPart.Size = Vector3.new(2, 2, 2)
	magicPart.Color = Color3.fromRGB(0, 255, 255) -- ‡∏™‡∏µ‡∏ü‡πâ‡∏≤
	magicPart.Material = Enum.Material.Neon
	
	-- 2. ‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ 5 ‡∏´‡∏ô‡πà‡∏ß‡∏¢
	magicPart.CFrame = rootPart.CFrame * CFrame.new(0, 0, -5)
	
	-- 3. ‡πÉ‡∏™‡πà‡πÅ‡∏£‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏û‡∏∏‡πà‡∏á‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ (‡πÅ‡∏ñ‡∏°‡πÉ‡∏´‡πâ)
	local velocity = Instance.new("LinearVelocity")
	velocity.MaxForce = 100000
	velocity.VectorVelocity = rootPart.CFrame.LookVector * 50 -- ‡∏û‡∏∏‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß 50
	velocity.Attachment0 = Instance.new("Attachment", magicPart)
	velocity.Parent = magicPart
	
	-- 4. ‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô‡πÇ‡∏•‡∏Å
	magicPart.Parent = workspace
	
	-- 5. ‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏Ñ)
	game:GetService("Debris"):AddItem(magicPart, 3)
	
	print("‚ú® Spawned Magic Cube!")
end

function AbilityController:Init()
	-- ‡∏£‡∏≠‡∏ü‡∏±‡∏á Event ‡∏ä‡∏∑‡πà‡∏≠ INPUT_ACTION ‡∏à‡∏≤‡∏Å InputController
	EventBus:On(Events.INPUT_ACTION, function(actionName)
		
		-- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏î ‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏° "‡πÇ‡∏à‡∏°‡∏ï‡∏µ" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
		if actionName == "ATTACK" then
			SpawnMagicCube()
			
		elseif actionName == "INTERACT" then
			print("üîò Interact button pressed (Nothing spawned)")
		end
		
	end)
end

return AbilityController